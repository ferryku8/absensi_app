pubspec.yaml
name: absensi_offline
description: "A new Flutter project."
# The following line prevents the package from being accidentally published to
# pub.dev using `flutter pub publish`. This is preferred for private packages.
publish_to: "none" # Remove this line if you wish to publish to pub.dev

# The following defines the version and build number for your application.
# A version number is three numbers separated by dots, like 1.2.43
# followed by an optional build number separated by a +.
# Both the version and the builder number may be overridden in flutter
# build by specifying --build-name and --build-number, respectively.
# In Android, build-name is used as versionName while build-number used as versionCode.
# Read more about Android versioning at https://developer.android.com/studio/publish/versioning
# In iOS, build-name is used as CFBundleShortVersionString while build-number is used as CFBundleVersion.
# Read more about iOS versioning at
# https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html
# In Windows, build-name is used as the major, minor, and patch parts
# of the product and file versions while build-number is used as the build suffix.
version: 1.0.0+1

environment:
  sdk: ^3.9.2

# Dependencies specify other packages that your package needs in order to work.
# To automatically upgrade your package dependencies to the latest versions
# consider running `flutter pub upgrade --major-versions`. Alternatively,
# dependencies can be manually updated by changing the version numbers below to
# the latest version available on pub.dev. To see which dependencies have newer
# versions available, run `flutter pub outdated`.
dependencies:
  flutter:
    sdk: flutter
  get: ^4.6.6
  get_storage: ^2.1.1
  intl: ^0.19.0
  geolocator: ^11.0.0

  camera: ^0.10.5+9
  path_provider: ^2.1.2
  path: ^1.9.0

dev_dependencies:
  flutter_test:
    sdk: flutter

  # The "flutter_lints" package below contains a set of recommended lints to
  # encourage good coding practices. The lint set provided by the package is
  # activated in the `analysis_options.yaml` file located at the root of your
  # package. See that file for information about deactivating specific lint
  # rules and activating additional ones.
  flutter_lints: ^5.0.0

# For information on the generic Dart part of this file, see the
# following page: https://dart.dev/tools/pub/pubspec

# The following section is specific to Flutter packages.
flutter:
  # The following line ensures that the Material Icons font is
  # included with your application, so that you can use the icons in
  # the material Icons class.
  uses-material-design: true

  # To add assets to your application, add an assets section, like this:
  # assets:
  #   - images/a_dot_burr.jpeg
  #   - images/a_dot_ham.jpeg

  # An image asset can refer to one or more resolution-specific "variants", see
  # https://flutter.dev/to/resolution-aware-images

  # For details regarding adding assets from package dependencies, see
  # https://flutter.dev/to/asset-from-package

  # To add custom fonts to your application, add a fonts section here,
  # in this "flutter" section. Each entry in this list should have a
  # "family" key with the font family name, and a "fonts" key with a
  # list giving the asset and other descriptors for the font. For
  # example:
  # fonts:
  #   - family: Schyler
  #     fonts:
  #       - asset: fonts/Schyler-Regular.ttf
  #       - asset: fonts/Schyler-Italic.ttf
  #         style: italic
  #   - family: Trajan Pro
  #     fonts:
  #       - asset: fonts/TrajanPro.ttf
  #       - asset: fonts/TrajanPro_Bold.ttf
  #         weight: 700
  #
  # For details regarding fonts from package dependencies,
  # see https://flutter.dev/to/font-from-package

lib > main
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:get_storage/get_storage.dart';

// Import Views
import 'views/login_view.dart';
import 'views/dashboard_view.dart';

// Import Controllers (untuk dependency injection awal jika diperlukan)
import 'controllers/auth_controller.dart';

void main() async {
  // Inisialisasi Storage (Local DB)
  await GetStorage.init();
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return GetMaterialApp(
      title: 'Absensi Offline',
      debugShowCheckedModeBanner: false,
      theme: ThemeData(
        primarySwatch: Colors.blue,
        scaffoldBackgroundColor: const Color(0xFFF5F7FA),
        fontFamily: 'sans-serif',
      ),
      // Route Awal
      initialRoute: '/login',
      getPages: [
        GetPage(
          name: '/login',
          page: () => LoginView(),
          // Binding AuthController dibuat saat masuk halaman Login
          binding: BindingsBuilder(() {
            Get.put(AuthController());
          }),
        ),
        GetPage(name: '/dashboard', page: () => DashboardView()),
      ],
    );
  }
}

lib > controllers > attendance_controller.dart
import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:get_storage/get_storage.dart';
import 'package:intl/intl.dart';
import 'package:geolocator/geolocator.dart';
import 'dart:io';
import 'package:http/http.dart' as http; // Tambahkan package http

class AttendanceController extends GetxController {
  final box = GetStorage();

  // --- CONFIG SERVER (Ganti dengan IP Laptop/Server kamu) ---
  // Jika pakai Emulator Android: gunakan 10.0.2.2
  // Jika pakai HP fisik (USB Debugging): gunakan IP Laptop (misal 192.168.1.x)
  final String baseUrl = "http://10.0.2.2:8000/api";

  // --- SETUP KAMERA ---
  CameraController? cameraController;
  var isCameraInitialized = false.obs;
  late List<CameraDescription> cameras;

  // Observable List untuk riwayat
  var historyList = <Map<String, dynamic>>[].obs;
  var totalAbsence = 0.obs;
  var totalLate = 0.obs;
  var isLoading = false.obs;
  var isSyncing = false.obs; // Status loading saat sinkronisasi

  @override
  void onInit() {
    super.onInit();
    loadData();
    initializeCamera();
  }

  @override
  void onClose() {
    cameraController?.dispose();
    super.onClose();
  }

  // --- LOGIC INIT KAMERA ---
  Future<void> initializeCamera() async {
    try {
      cameras = await availableCameras();
      final frontCamera = cameras.firstWhere(
        (camera) => camera.lensDirection == CameraLensDirection.front,
        orElse: () => cameras.first,
      );

      cameraController = CameraController(
        frontCamera,
        ResolutionPreset.medium,
        enableAudio: false,
      );

      await cameraController!.initialize();
      isCameraInitialized.value = true;
    } catch (e) {
      print("Error Camera: $e");
    }
  }

  void loadData() {
    if (box.hasData('attendance_logs')) {
      List<dynamic> storedData = box.read('attendance_logs');
      historyList.assignAll(
        storedData.map((e) => e as Map<String, dynamic>).toList(),
      );
      updateStats();
    }
  }

  // --- FUNGSI GPS ---
  Future<Position?> _getGeoLocation() async {
    bool serviceEnabled = await Geolocator.isLocationServiceEnabled();
    if (!serviceEnabled) {
      Get.snackbar("Error GPS", "Mohon aktifkan GPS.");
      return null;
    }

    LocationPermission permission = await Geolocator.checkPermission();
    if (permission == LocationPermission.denied) {
      permission = await Geolocator.requestPermission();
      if (permission == LocationPermission.denied) return null;
    }

    if (permission == LocationPermission.deniedForever) return null;

    return await Geolocator.getCurrentPosition(
      desiredAccuracy: LocationAccuracy.high,
    );
  }

  // --- LOGIC CLOCK IN ---
  Future<void> clockIn() async {
    final now = DateTime.now();
    final today = DateFormat('dd MMMM yyyy').format(now);

    if (historyList.any((e) => e['date'] == today)) {
      Get.snackbar("Info", "Sudah Clock In hari ini!");
      return;
    }

    isLoading.value = true;

    if (!isCameraInitialized.value || cameraController == null) {
      isLoading.value = false;
      Get.snackbar("Error", "Kamera belum siap");
      return;
    }

    try {
      XFile photo = await cameraController!.takePicture();
      Position? position = await _getGeoLocation();

      Map<String, dynamic> newLog = {
        'date': today,
        'clockIn': DateFormat('HH:mm:ss').format(now),
        'clockOut': '--:--:--',
        'photo_in': photo.path,
        'lat_in': position?.latitude ?? 0.0,
        'long_in': position?.longitude ?? 0.0,
        'address_in':
            "Lat: ${position?.latitude}, Long: ${position?.longitude}",
        'status': now.hour > 9 ? 'Late' : 'On Time',
        'is_synced': false, // Menandai data belum dikirim ke server
      };

      historyList.insert(0, newLog);
      saveToStorage();

      Get.back();
      Get.snackbar("Sukses", "Berhasil Clock In (Offline Saved)!");
    } catch (e) {
      Get.snackbar("Error", "Gagal: $e");
    } finally {
      isLoading.value = false;
    }
  }

  // --- LOGIC CLOCK OUT ---
  Future<void> clockOut() async {
    final now = DateTime.now();
    final today = DateFormat('dd MMMM yyyy').format(now);
    int index = historyList.indexWhere((e) => e['date'] == today);

    if (index != -1) {
      if (historyList[index]['clockOut'] != '--:--:--') {
        Get.snackbar("Info", "Sudah Clock Out hari ini.");
        return;
      }

      isLoading.value = true;
      try {
        XFile photo = await cameraController!.takePicture();
        Position? position = await _getGeoLocation();

        var updatedLog = historyList[index];
        updatedLog['clockOut'] = DateFormat('HH:mm:ss').format(now);
        updatedLog['photo_out'] = photo.path;
        updatedLog['lat_out'] = position?.latitude ?? 0.0;
        updatedLog['long_out'] = position?.longitude ?? 0.0;
        updatedLog['address_out'] =
            "Lat: ${position?.latitude}, Long: ${position?.longitude}";
        updatedLog['is_synced'] =
            false; // Reset sync status karena ada update data

        historyList[index] = updatedLog;
        saveToStorage();

        Get.back();
        Get.snackbar("Sukses", "Berhasil Clock Out (Offline Saved)!");
      } catch (e) {
        Get.snackbar("Error", "Gagal: $e");
      } finally {
        isLoading.value = false;
      }
    } else {
      Get.snackbar("Error", "Belum Clock In hari ini!");
    }
  }

  // --- LOGIC SINKRONISASI KE LARAVEL ---
  Future<void> syncDataToBackend() async {
    // 1. Filter data yang belum di-sync
    var unsyncedData = historyList
        .where((e) => e['is_synced'] == false)
        .toList();

    if (unsyncedData.isEmpty) {
      Get.snackbar("Info", "Semua data sudah tersinkronisasi.");
      return;
    }

    isSyncing.value = true;
    int successCount = 0;

    for (var log in unsyncedData) {
      try {
        var request = http.MultipartRequest(
          'POST',
          Uri.parse('$baseUrl/attendance-sync'),
        );

        // Kirim User ID (Hardcode dulu '1' atau ambil dari AuthController)
        request.fields['user_id'] = '1';
        request.fields['date'] = log['date'];
        request.fields['clock_in'] = log['clockIn'];
        request.fields['clock_out'] = log['clockOut'];
        request.fields['lat_in'] = log['lat_in'].toString();
        request.fields['long_in'] = log['long_in'].toString();
        request.fields['status'] = log['status'];

        // Upload Foto Masuk
        if (log['photo_in'] != null && File(log['photo_in']).existsSync()) {
          request.files.add(
            await http.MultipartFile.fromPath('photo_in', log['photo_in']),
          );
        }

        // Upload Foto Pulang (jika ada)
        if (log['photo_out'] != null &&
            log['clockOut'] != '--:--:--' &&
            File(log['photo_out']).existsSync()) {
          request.files.add(
            await http.MultipartFile.fromPath('photo_out', log['photo_out']),
          );
        }

        var response = await request.send();

        if (response.statusCode == 200) {
          // Jika sukses, update status lokal jadi true
          int index = historyList.indexOf(log);
          if (index != -1) {
            var updatedLog = Map<String, dynamic>.from(log);
            updatedLog['is_synced'] = true;
            historyList[index] = updatedLog;
          }
          successCount++;
        } else {
          print("Gagal sync tanggal ${log['date']}: ${response.statusCode}");
        }
      } catch (e) {
        print("Error connection: $e");
      }
    }

    // Simpan perubahan status sync ke storage
    saveToStorage();
    isSyncing.value = false;

    if (successCount > 0) {
      Get.snackbar(
        "Sukses",
        "$successCount data berhasil di-upload ke server!",
      );
    } else {
      Get.snackbar("Gagal", "Gagal menghubungi server. Cek koneksi internet.");
    }
  }

  void saveToStorage() {
    box.write('attendance_logs', historyList.toList());
    updateStats();
  }

  void updateStats() {
    totalAbsence.value = historyList.length;
    totalLate.value = historyList.where((e) => e['status'] == 'Late').length;
  }
}

lib > controllers > auth_controller.dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';

class AuthController extends GetxController {
  final emailC = TextEditingController();
  final passC = TextEditingController();

  // Simulasi Hardcoded Login
  void login() {
    // Sesuai request: Username dan password dimasukkan dulu
    if (emailC.text == "admin" && passC.text == "1234") {
      Get.snackbar(
        "Sukses",
        "Login Berhasil",
        backgroundColor: Colors.green,
        colorText: Colors.white,
      );
      Get.offAllNamed('/dashboard');
    } else {
      Get.snackbar(
        "Error",
        "Email atau Password salah (Coba: admin / 1234)",
        backgroundColor: Colors.red,
        colorText: Colors.white,
      );
    }
  }

  void logout() {
    Get.offAllNamed('/login');
  }
}

lib > views > tabs > home_tab.dart
// ... existing imports ...
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:intl/intl.dart';
import '../../controllers/attendance_controller.dart';
import '../attendance_view.dart';

class HomeTab extends StatelessWidget {
  final AttendanceController controller = Get.find<AttendanceController>();

  @override
  Widget build(BuildContext context) {
    // ... existing code (SafeArea, Column, Profile Header) ...
    return SafeArea(
      child: SingleChildScrollView(
        child: Padding(
          padding: const EdgeInsets.all(20.0),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // ... existing Header Code ...

              // GANTI BAGIAN GRID VIEW BUTTON SYNCHRON DI BAWAH INI:
              SizedBox(height: 20),
              Container(
                padding: EdgeInsets.all(20),
                decoration: BoxDecoration(
                  gradient: LinearGradient(
                    begin: Alignment.topCenter,
                    end: Alignment.bottomCenter,
                    colors: [Colors.cyan.shade400, Colors.blue.shade800],
                  ),
                  borderRadius: BorderRadius.circular(20),
                ),
                child: GridView.count(
                  shrinkWrap: true,
                  physics: NeverScrollableScrollPhysics(),
                  crossAxisCount: 2,
                  mainAxisSpacing: 15,
                  crossAxisSpacing: 15,
                  childAspectRatio: 1.3,
                  children: [
                    _buildActionButton("CHECK IN", Icons.login, () {
                      Get.to(() => AttendanceView());
                    }),

                    _buildActionButton("CHECK OUT", Icons.logout, () {
                      Get.to(() => AttendanceView());
                    }),

                    // --- TOMBOL SINKRONISASI UPDATE ---
                    Obx(
                      () => Material(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(10),
                        child: InkWell(
                          onTap: controller.isSyncing.value
                              ? null
                              : () => controller.syncDataToBackend(),
                          borderRadius: BorderRadius.circular(10),
                          child: Column(
                            mainAxisAlignment: MainAxisAlignment.center,
                            children: [
                              Container(
                                padding: EdgeInsets.all(10),
                                decoration: BoxDecoration(
                                  color: Colors.blue.shade50,
                                  borderRadius: BorderRadius.circular(10),
                                ),
                                child: controller.isSyncing.value
                                    ? SizedBox(
                                        width: 30,
                                        height: 30,
                                        child: CircularProgressIndicator(
                                          strokeWidth: 2,
                                        ),
                                      )
                                    : Icon(
                                        Icons.cloud_upload,
                                        size: 30,
                                        color: Colors.blue.shade700,
                                      ),
                              ),
                              SizedBox(height: 10),
                              Text(
                                controller.isSyncing.value
                                    ? "UPLOADING..."
                                    : "SYNCHRON",
                                style: TextStyle(
                                  fontWeight: FontWeight.bold,
                                  fontSize: 12,
                                ),
                              ),
                            ],
                          ),
                        ),
                      ),
                    ),

                    _buildActionButton("CALENDER", Icons.calendar_today, () {}),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }

  // ... existing helper widgets (_buildTimeCard, _buildStatItem, _buildActionButton) ...
  Widget _buildActionButton(String label, IconData icon, VoidCallback onTap) {
    return Material(
      color: Colors.white,
      borderRadius: BorderRadius.circular(10),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(10),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Container(
              padding: EdgeInsets.all(10),
              decoration: BoxDecoration(
                color: Colors.blue.shade50,
                borderRadius: BorderRadius.circular(10),
              ),
              child: Icon(icon, size: 30, color: Colors.blue.shade700),
            ),
            SizedBox(height: 10),
            Text(
              label,
              style: TextStyle(fontWeight: FontWeight.bold, fontSize: 12),
            ),
          ],
        ),
      ),
    );
  }

  // ... existing widget helpers if any ...
  Widget _buildTimeCard(String title, AttendanceController ctrl) {
    // ... existing code from previous file ...
    return Container(); // Placeholder logic
  }

  Widget _buildStatItem(String label, String value) {
    return Column(children: [Text(label), Text(value)]); // Placeholder logic
  }
}

lib > views > attendance_view.dart
import 'dart:io';
import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:intl/intl.dart';
import '../controllers/attendance_controller.dart';

class AttendanceView extends StatelessWidget {
  final AttendanceController controller = Get.find<AttendanceController>();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      appBar: AppBar(
        backgroundColor: Colors.white,
        elevation: 0,
        leading: IconButton(
          icon: Icon(Icons.arrow_back_ios, color: Colors.black),
          onPressed: () => Get.back(),
        ),
        title: Text(
          "Clock In",
          style: TextStyle(color: Colors.black, fontWeight: FontWeight.bold),
        ),
        centerTitle: true,
      ),
      body: Column(
        children: [
          // 1. Tanggal
          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
            child: Container(
              padding: EdgeInsets.all(12),
              decoration: BoxDecoration(
                border: Border.all(color: Colors.grey.shade300),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  Icon(Icons.calendar_today, color: Colors.blue, size: 20),
                  SizedBox(width: 10),
                  Text(
                    DateFormat('dd MMMM yyyy').format(DateTime.now()),
                    style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
                  ),
                ],
              ),
            ),
          ),

          // 2. Timeline
          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 20),
            child: Obx(() {
              final today = DateFormat('dd MMMM yyyy').format(DateTime.now());
              final log = controller.historyList.firstWhere(
                (e) => e['date'] == today,
                orElse: () => {},
              );
              String clockInTime = log['clockIn'] ?? "-- : --";
              String clockOutTime = log['clockOut'] ?? "-- : --";

              return Column(
                children: [
                  _buildTimelineItem(
                    title: "Clock In",
                    time: clockInTime,
                    isActive: clockInTime != "-- : --",
                    isFirst: true,
                    isLast: false,
                    buttonText: "Clock In",
                    btnColor: clockInTime != "-- : --"
                        ? Colors.grey.shade200
                        : Colors.blue.shade50,
                    btnTextColor: clockInTime != "-- : --"
                        ? Colors.grey
                        : Colors.blue,
                  ),
                  _buildTimelineItem(
                    title: "Clock Out",
                    time: clockOutTime,
                    isActive: clockOutTime != "-- : --",
                    isFirst: false,
                    isLast: true,
                    buttonText: "Clock Out",
                    btnColor: clockOutTime != "-- : --"
                        ? Colors.grey.shade200
                        : Colors.blue,
                    btnTextColor: clockOutTime != "-- : --"
                        ? Colors.grey
                        : Colors.white,
                  ),
                ],
              );
            }),
          ),

          SizedBox(height: 10),

          // 3. LIVE CAMERA PREVIEW (Bagian Utama)
          Expanded(
            child: ClipRRect(
              borderRadius: BorderRadius.vertical(top: Radius.circular(30)),
              child: Stack(
                alignment: Alignment.bottomCenter,
                children: [
                  // LAYAR KAMERA / HASIL FOTO
                  Obx(() {
                    // Cek apakah user sudah selesai absen hari ini?
                    final today = DateFormat(
                      'dd MMMM yyyy',
                    ).format(DateTime.now());
                    final log = controller.historyList.firstWhere(
                      (e) => e['date'] == today,
                      orElse: () => {},
                    );

                    bool isClockOutDone =
                        log.isNotEmpty && log['clockOut'] != '--:--:--';
                    bool isClockInDone =
                        log.isNotEmpty && log['clockIn'] != null;

                    // KONDISI 1: Jika sudah Pulang -> Tampilkan Foto Pulang
                    if (isClockOutDone && log['photo_out'] != null) {
                      return Container(
                        width: double.infinity,
                        height: double.infinity,
                        child: Image.file(
                          File(log['photo_out']),
                          fit: BoxFit.cover,
                        ),
                      );
                    }

                    // KONDISI 2: Jika Kamera Siap & Belum Selesai -> TAMPILKAN LIVE CAMERA
                    if (controller.isCameraInitialized.value) {
                      // CameraPreview butuh controller dari camera package
                      return Container(
                        width: double.infinity,
                        height: double.infinity,
                        child: CameraPreview(controller.cameraController!),
                      );
                    }

                    // KONDISI 3: Loading / Placeholder
                    return Container(
                      color: Colors.black,
                      child: Center(
                        child: CircularProgressIndicator(color: Colors.white),
                      ),
                    );
                  }),

                  // OVERLAY GRADASI HITAM
                  Container(
                    height: 150,
                    decoration: BoxDecoration(
                      gradient: LinearGradient(
                        begin: Alignment.topCenter,
                        end: Alignment.bottomCenter,
                        colors: [
                          Colors.transparent,
                          Colors.black.withOpacity(0.8),
                        ],
                      ),
                    ),
                  ),

                  // TOMBOL SNAPSHOT (JEPRET)
                  Positioned(
                    bottom: 30,
                    child: Obx(() {
                      if (controller.isLoading.value) {
                        return CircularProgressIndicator(color: Colors.white);
                      }

                      // Logic Text Status
                      final today = DateFormat(
                        'dd MMMM yyyy',
                      ).format(DateTime.now());
                      final log = controller.historyList.firstWhere(
                        (e) => e['date'] == today,
                        orElse: () => {},
                      );
                      bool isClockInDone =
                          log.isNotEmpty && log['clockIn'] != null;
                      bool isClockOutDone =
                          log.isNotEmpty && log['clockOut'] != '--:--:--';

                      if (isClockOutDone) {
                        return Container(
                          padding: EdgeInsets.symmetric(
                            horizontal: 20,
                            vertical: 10,
                          ),
                          decoration: BoxDecoration(
                            color: Colors.green,
                            borderRadius: BorderRadius.circular(20),
                          ),
                          child: Text(
                            "Absensi Selesai",
                            style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        );
                      }

                      return Column(
                        children: [
                          Text(
                            isClockInDone
                                ? "Tekan untuk Pulang"
                                : "Tekan untuk Masuk",
                            style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.w500,
                            ),
                          ),
                          SizedBox(height: 15),
                          GestureDetector(
                            onTap: () {
                              if (!isClockInDone) {
                                controller.clockIn();
                              } else if (!isClockOutDone) {
                                controller.clockOut();
                              }
                            },
                            child: Container(
                              height: 80,
                              width: 80,
                              decoration: BoxDecoration(
                                shape: BoxShape.circle,
                                border: Border.all(
                                  color: Colors.white,
                                  width: 4,
                                ),
                                color: Colors
                                    .transparent, // Transparan biar kelihatan 'bolong' kyk tombol shutter
                              ),
                              child: Center(
                                child: Container(
                                  height: 65,
                                  width: 65,
                                  decoration: BoxDecoration(
                                    color: Colors.white,
                                    shape: BoxShape.circle,
                                  ),
                                  child: Icon(
                                    Icons.camera_alt,
                                    color: Colors.blue,
                                    size: 30,
                                  ),
                                ),
                              ),
                            ),
                          ),
                        ],
                      );
                    }),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildTimelineItem({
    required String title,
    required String time,
    required bool isActive,
    required bool isFirst,
    required bool isLast,
    required String buttonText,
    required Color btnColor,
    required Color btnTextColor,
  }) {
    return Row(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Column(
          children: [
            Container(
              width: 24,
              height: 24,
              decoration: BoxDecoration(
                shape: BoxShape.circle,
                color: isActive ? Colors.blue : Colors.white,
                border: Border.all(color: Colors.blue, width: 2),
              ),
              child: isActive
                  ? Icon(Icons.check, size: 16, color: Colors.white)
                  : null,
            ),
            if (!isLast)
              Container(
                width: 2,
                height: 40,
                color: Colors.grey.shade300,
                margin: EdgeInsets.symmetric(vertical: 4),
              ),
          ],
        ),
        SizedBox(width: 15),
        Expanded(
          child: Container(
            height: isLast ? null : 70,
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  time,
                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
                ),
                Text(title, style: TextStyle(color: Colors.grey, fontSize: 12)),
              ],
            ),
          ),
        ),
        Container(
          padding: EdgeInsets.symmetric(horizontal: 16, vertical: 8),
          decoration: BoxDecoration(
            color: btnColor,
            borderRadius: BorderRadius.circular(6),
          ),
          child: Text(
            buttonText,
            style: TextStyle(
              color: btnTextColor,
              fontWeight: FontWeight.bold,
              fontSize: 12,
            ),
          ),
        ),
      ],
    );
  }
}

lib > views > dashboard_view.dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/attendance_controller.dart';
import 'tabs/home_tab.dart';
import 'history_tab.dart';
import 'profile_tab.dart';

class DashboardView extends StatefulWidget {
  @override
  _DashboardViewState createState() => _DashboardViewState();
}

class _DashboardViewState extends State<DashboardView> {
  int _currentIndex = 0;

  // Inisialisasi Controller di Dashboard agar hidup selama Dashboard aktif
  final attendanceC = Get.put(AttendanceController());

  final List<Widget> _pages = [
    HomeTab(),
    HistoryTab(),
    Center(child: Text("Calendar Feature (Coming Soon)")),
    ProfileTab(),
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: _pages[_currentIndex],
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: (index) {
          setState(() {
            _currentIndex = index;
          });
        },
        type: BottomNavigationBarType.fixed,
        selectedItemColor: Colors.blueAccent,
        unselectedItemColor: Colors.grey,
        showUnselectedLabels: false,
        items: [
          BottomNavigationBarItem(icon: Icon(Icons.home_filled), label: 'Home'),
          BottomNavigationBarItem(icon: Icon(Icons.history), label: 'History'),
          BottomNavigationBarItem(
            icon: Icon(Icons.calendar_today),
            label: 'Calendar',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            label: 'Profile',
          ),
        ],
      ),
    );
  }
}

lib > views > dashboard_view.dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/attendance_controller.dart';
import 'tabs/home_tab.dart';
import 'history_tab.dart';
import 'profile_tab.dart';

class DashboardView extends StatefulWidget {
  @override
  _DashboardViewState createState() => _DashboardViewState();
}

class _DashboardViewState extends State<DashboardView> {
  int _currentIndex = 0;

  // Inisialisasi Controller di Dashboard agar hidup selama Dashboard aktif
  final attendanceC = Get.put(AttendanceController());

  final List<Widget> _pages = [
    HomeTab(),
    HistoryTab(),
    Center(child: Text("Calendar Feature (Coming Soon)")),
    ProfileTab(),
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: _pages[_currentIndex],
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: (index) {
          setState(() {
            _currentIndex = index;
          });
        },
        type: BottomNavigationBarType.fixed,
        selectedItemColor: Colors.blueAccent,
        unselectedItemColor: Colors.grey,
        showUnselectedLabels: false,
        items: [
          BottomNavigationBarItem(icon: Icon(Icons.home_filled), label: 'Home'),
          BottomNavigationBarItem(icon: Icon(Icons.history), label: 'History'),
          BottomNavigationBarItem(
            icon: Icon(Icons.calendar_today),
            label: 'Calendar',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            label: 'Profile',
          ),
        ],
      ),
    );
  }
}

lib > views > history_view.dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'dart:io'; // Wajib import ini untuk menampilkan File Foto
import '../../controllers/attendance_controller.dart';

class HistoryTab extends StatelessWidget {
  final AttendanceController controller = Get.find<AttendanceController>();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      appBar: AppBar(
        backgroundColor: Colors.white,
        elevation: 0,
        title: Text(
          "Attendance Data",
          style: TextStyle(color: Colors.black, fontWeight: FontWeight.bold),
        ),
        // Tombol Clear All SUDAH DIHAPUS DARI SINI
      ),
      body: Obx(() {
        if (controller.historyList.isEmpty) {
          return Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                Icon(Icons.history, size: 64, color: Colors.grey[300]),
                SizedBox(height: 16),
                Text(
                  "Belum ada riwayat absensi",
                  style: TextStyle(color: Colors.grey),
                ),
              ],
            ),
          );
        }
        return ListView.builder(
          padding: EdgeInsets.all(20),
          itemCount: controller.historyList.length,
          itemBuilder: (context, index) {
            final log = controller.historyList[index];
            return Container(
              margin: EdgeInsets.only(bottom: 15),
              padding: EdgeInsets.all(15),
              decoration: BoxDecoration(
                color: Colors.grey.shade100,
                borderRadius: BorderRadius.circular(10),
              ),
              child: Column(
                children: [
                  // Baris Atas: Tanggal & Status
                  Row(
                    children: [
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(
                              log['date'],
                              style: TextStyle(
                                fontWeight: FontWeight.bold,
                                fontSize: 16,
                              ),
                            ),
                            SizedBox(height: 5),
                            Container(
                              padding: EdgeInsets.symmetric(
                                horizontal: 8,
                                vertical: 4,
                              ),
                              decoration: BoxDecoration(
                                color: log['status'] == 'Late'
                                    ? Colors.red.withOpacity(0.1)
                                    : Colors.green.withOpacity(0.1),
                                borderRadius: BorderRadius.circular(5),
                              ),
                              child: Text(
                                log['status'],
                                style: TextStyle(
                                  color: log['status'] == 'Late'
                                      ? Colors.red
                                      : Colors.green,
                                  fontSize: 12,
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                    ],
                  ),
                  Divider(height: 20),
                  // Baris Bawah: Jam Masuk/Pulang, Foto & Lokasi
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Expanded(
                        child: _buildTimeColumn(
                          "Clock In",
                          log['clockIn'],
                          log['photo_in'],
                          log['address_in'],
                        ),
                      ),
                      Container(
                        width: 1,
                        height: 80,
                        color: Colors.grey.shade300,
                      ),
                      Expanded(
                        child: _buildTimeColumn(
                          "Clock Out",
                          log['clockOut'],
                          log['photo_out'],
                          log['address_out'],
                        ),
                      ),
                    ],
                  ),
                ],
              ),
            );
          },
        );
      }),
    );
  }

  Widget _buildTimeColumn(
    String label,
    String time,
    String? photoPath,
    String? address,
  ) {
    return Column(
      children: [
        Text(label, style: TextStyle(fontSize: 11, color: Colors.grey)),
        SizedBox(height: 4),
        Text(time, style: TextStyle(fontWeight: FontWeight.bold, fontSize: 14)),
        SizedBox(height: 8),

        // Menampilkan Thumbnail Foto
        if (photoPath != null && photoPath.isNotEmpty)
          InkWell(
            onTap: () => Get.dialog(
              Dialog(child: Image.file(File(photoPath))),
            ), // Zoom foto saat diklik
            child: ClipRRect(
              borderRadius: BorderRadius.circular(8),
              child: Image.file(
                File(photoPath),
                width: 60,
                height: 60,
                fit: BoxFit.cover,
                errorBuilder: (ctx, err, stack) => Container(
                  width: 60,
                  height: 60,
                  color: Colors.grey.shade300,
                  child: Icon(Icons.broken_image, size: 20),
                ),
              ),
            ),
          )
        else
          Icon(
            Icons.camera_alt_outlined,
            size: 30,
            color: Colors.grey.shade300,
          ),

        SizedBox(height: 8),

        // Menampilkan Lokasi (Latitude / Longitude)
        if (address != null)
          Text(
            address,
            textAlign: TextAlign.center,
            style: TextStyle(fontSize: 9, color: Colors.grey.shade600),
            maxLines: 2,
            overflow: TextOverflow.ellipsis,
          ),
      ],
    );
  }
}

lib > views > login_view
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/auth_controller.dart';

class LoginView extends StatelessWidget {
  final controller = Get.put(AuthController());

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Stack(
        children: [
          // Background Image Placeholder
          Container(
            decoration: BoxDecoration(
              image: DecorationImage(
                image: NetworkImage(
                  'https://images.unsplash.com/photo-1497366216548-37526070297c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                ),
                fit: BoxFit.cover,
                colorFilter: ColorFilter.mode(
                  Colors.black.withOpacity(0.4),
                  BlendMode.darken,
                ),
              ),
            ),
          ),
          // Login Form
          Center(
            child: Padding(
              padding: const EdgeInsets.all(24.0),
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Spacer(),
                  Text(
                    "OFFICE LOGIN",
                    style: TextStyle(
                      color: Colors.white,
                      fontSize: 28,
                      fontWeight: FontWeight.bold,
                      letterSpacing: 2,
                    ),
                  ),
                  SizedBox(height: 40),
                  // Email Input
                  Container(
                    decoration: BoxDecoration(
                      color: Colors.white,
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: TextField(
                      controller: controller.emailC,
                      decoration: InputDecoration(
                        hintText: "Email / Username",
                        prefixIcon: Icon(
                          Icons.email_outlined,
                          color: Colors.blue,
                        ),
                        border: InputBorder.none,
                        contentPadding: EdgeInsets.all(16),
                      ),
                    ),
                  ),
                  SizedBox(height: 16),
                  // Password Input
                  Container(
                    decoration: BoxDecoration(
                      color: Colors.white,
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: TextField(
                      controller: controller.passC,
                      obscureText: true,
                      decoration: InputDecoration(
                        hintText: "Password",
                        prefixIcon: Icon(
                          Icons.lock_outline,
                          color: Colors.blue,
                        ),
                        border: InputBorder.none,
                        contentPadding: EdgeInsets.all(16),
                      ),
                    ),
                  ),
                  Align(
                    alignment: Alignment.centerRight,
                    child: TextButton(
                      onPressed: () {},
                      child: Text(
                        "Forgot Password?",
                        style: TextStyle(color: Colors.white70),
                      ),
                    ),
                  ),
                  SizedBox(height: 20),
                  // Button
                  SizedBox(
                    width: double.infinity,
                    height: 50,
                    child: ElevatedButton(
                      onPressed: controller.login,
                      style: ElevatedButton.styleFrom(
                        backgroundColor: Colors.blueAccent,
                        shape: RoundedRectangleBorder(
                          borderRadius: BorderRadius.circular(8),
                        ),
                      ),
                      child: Text(
                        "Login",
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                    ),
                  ),
                  Spacer(),
                  Text(
                    "Versi 1.0.0 - Offline Mode",
                    style: TextStyle(color: Colors.white54),
                  ),
                  SizedBox(height: 20),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}

lib > views > profile_tab.dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../../controllers/auth_controller.dart';

class ProfileTab extends StatelessWidget {
  final AuthController authController = Get.find<AuthController>();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      body: SafeArea(
        child: Column(
          children: [
            SizedBox(height: 30),
            Center(
              child: Container(
                padding: EdgeInsets.all(3),
                decoration: BoxDecoration(
                  shape: BoxShape.circle,
                  border: Border.all(color: Colors.blue, width: 2),
                ),
                child: CircleAvatar(
                  radius: 50,
                  backgroundImage: NetworkImage(
                    'https://i.pravatar.cc/150?img=11',
                  ),
                ),
              ),
            ),
            SizedBox(height: 15),
            Text(
              "Alexander Morales",
              style: TextStyle(fontSize: 22, fontWeight: FontWeight.bold),
            ),
            Text("Staff", style: TextStyle(color: Colors.grey)),

            SizedBox(height: 30),
            Padding(
              padding: const EdgeInsets.symmetric(horizontal: 30),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    "Biodata",
                    style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                  ),
                  SizedBox(height: 20),
                  _buildProfileItem("Address", "Jl. Kutilang No. 58"),
                  _buildProfileItem("Age", "32"),
                  _buildProfileItem("Blood", "B+"),
                ],
              ),
            ),

            Spacer(),
            Padding(
              padding: const EdgeInsets.all(30.0),
              child: SizedBox(
                width: double.infinity,
                height: 50,
                child: ElevatedButton(
                  onPressed: authController.logout,
                  style: ElevatedButton.styleFrom(
                    backgroundColor: Colors.red.shade800,
                  ),
                  child: Text(
                    "LOGOUT",
                    style: TextStyle(fontWeight: FontWeight.bold),
                  ),
                ),
              ),
            ),
            SizedBox(height: 20),
          ],
        ),
      ),
    );
  }

  Widget _buildProfileItem(String label, String value) {
    return Padding(
      padding: const EdgeInsets.only(bottom: 15),
      child: Row(
        children: [
          SizedBox(
            width: 100,
            child: Text(label, style: TextStyle(fontWeight: FontWeight.bold)),
          ),
          Text(":  $value"),
        ],
      ),
    );
  }
}
